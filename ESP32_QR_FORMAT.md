# ğŸ“‹ ESP32 QR Code Format & System Flow

## ğŸ¯ QR Code Format (Generated by ESP32)

```json
{
  "package_token": "PKG001",
  "temperature": 36.53,
  "tamper_status": "tampered",
  "loop_connected": true,
  "acceleration": 9.81
}
```

### **Fields:**
- `package_token` (string): Unique package identifier
- `temperature` (float): Current temperature in Â°C
- `tamper_status` (string): "secure" or "tampered"
- `loop_connected` (boolean): Wire loop connection status (true = connected, false = broken)
- `acceleration` (float): Acceleration in m/sÂ²

---

## ğŸ”„ Complete System Flow

### **1. Package Creation (Sender)**
```
Sender creates package
    â†“
Backend generates package_token
    â†“
ESP32 device attached to package
    â†“
ESP32 generates QR code with sensor data
```

### **2. At Each Checkpoint (Logistics)**
```
ğŸ“¦ Package arrives at checkpoint
    â†“
ğŸ“· Logistics scans QR with website camera
    â†“
ğŸ“Š Website displays:
    - Temperature: 22.5Â°C
    - Tamper Status: Secure
    - Loop Status: Connected
    - Battery: 85%
    - Humidity: 45%
    â†“
âœ… Logistics reviews data
    â†“
ğŸ”˜ Clicks "Upload & Proceed" or "Return to Sender"
    â†“
ğŸ—„ï¸ Data saved to database (scan_logs array)
```

### **3. Final Delivery (Receiver)**
```
ğŸ“¦ Package delivered
    â†“
ğŸ“· Receiver scans QR with website camera
    â†“
ğŸ” Receiver enters 6-digit PIN
    â†“
ğŸ“œ Receiver sees complete journey:
    
    âœ… Checkpoint 1: Warehouse Dispatch
       ğŸŒ¡ï¸ Temp: 22.5Â°C | ğŸ”’ Tamper: Secure | ğŸ”Œ Loop: Connected
       â° Oct 31, 8:00 AM | âœ… Action: Proceed
    
    âœ… Checkpoint 2: Local Hub
       ğŸŒ¡ï¸ Temp: 23.1Â°C | ğŸ”’ Tamper: Secure | ğŸ”Œ Loop: Connected
       â° Oct 31, 12:00 PM | âœ… Action: Proceed
    
    âœ… Checkpoint 3: Regional Center
       ğŸŒ¡ï¸ Temp: 22.8Â°C | ğŸ”’ Tamper: Secure | ğŸ”Œ Loop: Connected
       â° Oct 31, 4:00 PM | âœ… Action: Proceed
    
    âœ… Checkpoint 4: Delivery Hub
       ğŸŒ¡ï¸ Temp: 23.5Â°C | ğŸ”’ Tamper: Secure | ğŸ”Œ Loop: Connected
       â° Oct 31, 8:00 PM | âœ… Action: Proceed
    â†“
âœ… Receiver clicks "Okay" to confirm
```

### **4. Sender Dashboard**
```
ğŸ“Š Sender logs in
    â†“
ğŸ“¦ Sees all packages with real-time status
    â†“
ğŸ” Clicks on PKG001
    â†“
ğŸ“œ Sees same journey as receiver:
    - All checkpoint scans
    - ESP32 sensor data at each checkpoint
    - Actions taken (proceed/return)
    - Timestamps
```

---

## ğŸ—„ï¸ Database Structure

```javascript
{
  package_id: "PKG001",
  package_token: "demo_token_electronics_001",
  sender_id: "sender123",
  receiver_phone: "+919876543210",
  pin: "123456",
  current_status: "in_transit",
  current_location: "Mumbai Central Hub",
  is_tampered: false,
  
  scan_logs: [
    {
      checkpoint_id: "CP001",
      name: "Warehouse Dispatch",
      location: "Mumbai Warehouse",
      scanned_at: "2025-11-01T08:00:00Z",
      scanned_by: "logistics_user1",
      action: "proceed",
      
      // ESP32 Data from QR Code
      temperature: 22.5,
      tamper_status: "secure",
      loop_connected: true,
      humidity: 45.0,
      battery_level: 85,
      shock_detected: false,
      gps_location: "19.0760,72.8777",
      
      notes: "Package dispatched from warehouse"
    },
    {
      checkpoint_id: "CP002",
      name: "Local Hub",
      location: "Mumbai Central Hub",
      scanned_at: "2025-11-01T12:00:00Z",
      scanned_by: "logistics_user2",
      action: "proceed",
      
      temperature: 23.1,
      tamper_status: "secure",
      loop_connected: true,
      humidity: 47.0,
      battery_level: 82,
      shock_detected: false,
      gps_location: "19.0760,72.8777",
      
      notes: "In transit to regional center"
    }
    // ... more checkpoints
  ],
  
  tamper_events: [],
  
  created_at: "2025-11-01T07:00:00Z",
  updated_at: "2025-11-01T20:00:00Z"
}
```

---

## âœ… What's Implemented:

### **Backend:**
- âœ… ESP32Data model with `loop_connected` field
- âœ… `/delivery/scan-qr` - Validate package
- âœ… `/delivery/upload-scan` - Save checkpoint data
- âœ… `/receiver/verify-package` - Receiver verification with PIN
- âœ… `/receiver/package/{token}` - Get package journey
- âœ… `/sender/packages` - Get all packages with scan logs
- âœ… `/sender/package/{id}/journey` - Get detailed journey

### **Frontend - Delivery Dashboard:**
- âœ… Camera QR scanner
- âœ… ESP32 data display (temperature, tamper, loop, battery, humidity)
- âœ… Checkpoint selection
- âœ… Upload & Proceed / Return to Sender buttons
- âœ… Package list view

### **Frontend - Receiver Scanner:**
- âœ… Camera QR scanner
- âœ… PIN entry (6 digits)
- âœ… Complete journey display with all checkpoint logs
- âœ… ESP32 data for each checkpoint (including loop_connected)
- âœ… Tamper event display
- âœ… "Okay" confirmation button

### **Frontend - Sender Dashboard:**
- âœ… Package list with real-time status
- âœ… Complete journey view with all scan logs
- âœ… ESP32 data at each checkpoint

---

## ğŸ“Š ESP32 Sensor Parameters:

| Parameter | Type | Description | Example |
|-----------|------|-------------|---------|
| `temperature` | float | Temperature in Â°C | 36.53 |
| `tamper_status` | string | "secure" or "tampered" | "tampered" |
| `loop_connected` | boolean | Wire loop status | true |
| `acceleration` | float | Acceleration in m/sÂ² | 9.81 |
| `humidity` | float | Humidity percentage (optional) | 45.0 |
| `battery_level` | int | Battery percentage (optional) | 85 |
| `shock_detected` | boolean | Shock/impact detected (optional) | false |
| `gps_location` | string | GPS coordinates (optional) | "19.0760,72.8777" |

---

## ğŸ¯ Summary:

**Your system is COMPLETE!** âœ…

All FOUR parameters you requested are implemented:
1. âœ… **Temperature** - Displayed and logged
2. âœ… **Tamper Status** - Displayed and logged
3. âœ… **Loop Connected** - Displayed and logged
4. âœ… **Acceleration** - Displayed and logged (NEW!)

**Data flows correctly:**
- Logistics scans â†’ Uploads to database
- Receiver scans â†’ Sees all logs
- Sender dashboard â†’ Sees all logs

**Ready for demo!** ğŸš€
